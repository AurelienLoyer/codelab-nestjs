== Validation des donnÃ©es

=== Validation des donnÃ©es

* GrÃ¢ce au pipe `ValidationPipe`, nous allons pouvoir valider les donnÃ©es entrantes
* La validation peut s'activer 
** localement Ã  un endpoint

[source,typescript]
----
@Post()
@UsePipes(ValidationPipe)
getHello(@Body() body: User) { ... }
----

=== Validation des donnÃ©es

* globalement pour toute l'application

[source,typescript]
----
async function bootstrap() {
  const app = await NestFactory.create(ApplicationModule);
  app.useGlobalPipes(new ValidationPipe());
  await app.listen(3000);
}
bootstrap();
----

* localement Ã  un paramÃ¨tre

[source,typescript]
----
@Post()
getHello(@Body(new ValidationPipe()) body: User) { ... }
----

=== Validation des donnÃ©es

* Le validateur se base sur les modules `class-validator` et `class-transformer`

[source]
----
npm install -D class-validator class-transformer
----

=== Validation des donnÃ©es

* Il suffit d'ajouter des dÃ©corateurs sur vos models

[source,typescript]
----
import { IsString, IsInt, IsEmail, IsDate } from 'class-validator';

export class User {
  @IsString()
  readonly name: string;

  @IsInt()
  readonly age: number;

  @IsEmail()
  readonly email: string;

  @IsDate()
  readonly birthDate: date;
}
----


=== Custom validateur

[source,typescript]
----
import { ValidatorConstraint, ValidatorConstraintInterface, ValidationArguments } from "class-validator";

@ValidatorConstraint({ 
  name: "passwordValidator", 
  async: false 
})
export class PasswordValidator implements ValidatorConstraintInterface {

    validate(password: string, args: ValidationArguments) {
        return password.length > 5;
    }
    defaultMessage(args: ValidationArguments) { 
        return "Erreur: 'password' doit Ãªtre plus compliquÃ© ğŸ˜¨";
    }
}

/**
@Validate(PasswordValidator)
readonly password: string;
 */
----


=== Ã€ vous de jouer !

* Activez la validation de maniÃ¨re globale Ã  l'application 
* Ajouter les contraintes suivantes sur votre classe Beer
** `id` doit Ãªtre un `number`
** `label` doit Ãªtre une `string`
** `description` doit Ãªtre une `string`, avec un taille entre 10 et 80 caractÃ¨res
** `image` doit Ãªtre une `string`, et se terminer par un extension valide (via un custom validateur)
** `price` doit Ãªtre une `number`, compris entre 0 et 100
** `stock` doit Ãªtre une `entier`
`
